###
### name: דוד בורג
### ID  : [מספר תעודת זהות]
### course: אפידמיולוגיה (HIT.ac.il)
### lesson: סטטיסטיקה תאורית וניתות בסיסי 02-04   
### date  : 15/06/2025
###  
###  נלמד לבצע ניתוח סטטיסטי פשוט
###


## Reset memory
```{r setup-packages, include false}
rm(list = ls(all.names = TRUE))
lapply(paste('package:',names(sessionInfo()$otherPkgs),sep=""),detach,character.only=TRUE,unload=TRUE,force=TRUE)
gc()
```


## Load required packages
```{r load-packages, include false}  
install.packages("readxl")
library(readxl)     # For reading Excel files

## other packages
install.packages(c("dplyr", "ggplot2", "DescTools", "modeest"))
library(dplyr)      # For data manipulation
library(ggplot2)    # For creating plots
library(DescTools)  # For statistical functions like skewness and kurtosis
library(modeest)    # to estimate the mode (R does not have a built-in mode function)
```

## Read the data from the excel file
```{r read-data, echo=FALSE}
## read the data in the excel file
data <- read_excel("C:/Users/owner/Desktop/birthsR.xls", sheet = 1)
summary(data)
```

## Read the data from the excel file
```{r read-data, echo=FALSE}
data <- birthsR #or this way by import Dataset
summary(data)

data$weight0 <- as.numeric(data$weight0)
data$weight1 <- as.numeric(data$weight1)
data$newborn_gender <- as.factor(data$newborn_gender)
data$pacifier_dich <- as.factor(data$pacifier_dich)
```



### Calculate mean, median, mode, standard deviation, interquartile range, kurtosis, and skewness.
```{r descriptive, echo=TRUE}


(2,2,4,5,7,8,8,8)

#central tendency 

# Function to find the mode  **** THIS IS WRONG!!! ****
#get_mode <- function(v) {
#  uniqv <- unique(v) ##gives unique values only
#  uniqv[which.max(tabulate(match(v, uniqv)))] ##match give the first location of each value
## tabulate calculates how many times each value appears
## which.max gives the first place of the value that repeat's the most
#}


example_data <- c(10, 16, 12, 10, 12, 10, 38, 12, 28, 24)
example_mode <- as.vector(Mode(example_data))
example_mode


# Calculations weight0
mean_weight0 <- mean(data$weight0, na.rm = TRUE)        # Mean
mode_weight0 <- as.vector(Mode(data$weight0))           # Mode
median_weight0 <- median(data$weight0, na.rm = TRUE)    # Median
sd_weight0 <- sd(data$weight0, na.rm = TRUE)            # Standard Deviation
iqr_weight0 <- IQR(data$weight0, na.rm = TRUE)          # Interquartile Range
min_weight0 <- min(data$weight0, na.rm = TRUE)          # Minimum
max_weight0 <- max(data$weight0, na.rm = TRUE)          # Maximum




# Maximum

# Create a data frame to neatly display the statistics
stats_df <- data.frame(
  Statistic = c("Mean", "Mode", "Median", "Standard Deviation", "Interquartile Range", "Minimum", "Maximum"),
  Value = c(mean_weight0, mode_weight0, median_weight0, sd_weight0, iqr_weight0, min_weight0, max_weight0)
)

knitr::kable(stats_df, col.names = c("Statistic", "Value"), caption = "Summary Statistics for weight0")


# Calculations weight1
mean_weight1 <- mean(data$weight1, na.rm = TRUE)  # Mean
mode_weight1 <- get_mode(data$weight1)            # Mode
median_weight1 <- median(data$weight1, na.rm = TRUE)  # Median
sd_weight1 <- sd(data$weight1, na.rm = TRUE)          # Standard Deviation
iqr_weight1 <- IQR(data$weight1, na.rm = TRUE)        # Interquartile Range
min_weight1 <- min(data$weight1, na.rm = TRUE)        # Minimum
max_weight1 <- max(data$weight1, na.rm = TRUE)        # Maximum

# Create a data frame to neatly display the statistics
stats_df <- data.frame(
  Statistic = c("Mean", "Mode", "Median", "Standard Deviation", "Interquartile Range", "Minimum", "Maximum"),
  Value = c(mean_weight1, mode_weight1, median_weight1, sd_weight1, iqr_weight1, min_weight1, max_weight1)
)

knitr::kable(stats_df, col.names = c("Statistic", "Value"), caption = "Summary Statistics for weight1")


# Function to find the mode for gender
get_mode <- function(v) {
  uniqv <- unique(v) ##gives the unique values only
  tabulated <- tabulate(match(v, uniqv))  ###tabulate calculates how many times each value appears
  most_freq_index <- which.max(tabulated) ###which.max gives the first place of the value that repeat's the most

  most_freq_value <- uniqv[most_freq_index]
  return(most_freq_value)
}
 
# Calculate the mode for newborn_gender
mode_newborn_gender <- get_mode(data$newborn_gender)

# Display the mode
mode_newborn_gender




#normality check
install.packages("e1071")  # Run this once if not installed
library(e1071)

# Calculate skewness
skewness_weight0 <- skewness(data$weight0, na.rm = TRUE)
skewness_weight1 <- skewness(data$weight1, na.rm = TRUE)

# Calculate kurtosis
kurtosis_weight0 <- kurtosis(data$weight0, na.rm = TRUE)
kurtosis_weight1 <- kurtosis(data$weight1, na.rm = TRUE)

# Display the skewness and kurtosis values
kurtosis_weight0 
skewness_weight0

kurtosis_weight1
skewness_weight1

```

###extra graphs
##creat boxplot of weight by gender
```{r boxplot, echo=TRUE}
library(ggplot2)
ggplot(data, aes(x = as.factor(newborn_gender), y = weight0)) +
  geom_boxplot() +
  labs(title = "Box Plot of Weight0 by Newborn Gender", x = "Gender", y = "Weight0")
```


##Pie Chart for Newborn Gender
```{r pie, echo=TRUE}
data$newborn_gender <- factor(data$newborn_gender, levels = c(0, 1), labels = c("Male", "Female"))
gender_counts <- table(data$newborn_gender)
pie(gender_counts, labels = paste(names(gender_counts), ": ", gender_counts), main = "Distribution of Newborn Gender")
```





##other tests
```{r pie, echo=TRUE}
install.packages("moments")
install.packages("dplyr")

library(dplyr)
library(moments)


```

###t test for independent

```{r pressure, echo=FALSE}
install.packages("car")
library(car)

data$newborn_gender <- factor(data$newborn_gender)
levene_result <- leveneTest(weight0 ~ newborn_gender, data = data)
levene_result

t_test_result <- t.test(weight0 ~ newborn_gender, data = data, var.equal = TRUE)  # or FALSE
t_test_result

```

# Performing a paired t-test
```{r pressure, echo=FALSE}
paired_t_test_result <- t.test(data$weight0, data$weight1, paired = TRUE)

# Print the results of the t-test
print(paired_t_test_result)


data1 <- na.omit(data[, c("weight0", "weight1")])
mean_weight0 <- mean(data1$weight0)
mean_weight1 <- mean(data1$weight1)
mean_weight0
mean_weight1
```





##ANOVA
```{r packages, echo=FALSE}
# Perform Levene's Test for homogeneity of variances
install.packages("vctrs", dependencies = TRUE)
install.packages("dpylr")
library(dplyr)
library(car)

data$BabyFeeding3 <- factor(data$BabyFeeding3,  labels = c("BF", "bottle", "combination"))



data_filtered <- data[!is.na(data$mother_age) & !is.na(data$BabyFeeding3), ]
summary_df <- aggregate(mother_age ~ BabyFeeding3, data = data_filtered, FUN = function(x) c(Mean = mean(x), Count = length(x)))

# Clean the format
summary_df <- data.frame(
  BabyFeeding3 = summary_df$BabyFeeding3,
  Mean_Mother_Age = summary_df$mother_age[, "Mean"],
  Count = summary_df$mother_age[, "Count"]
)

print(summary_df)

#Anova and it's assumption
data$BabyFeeding3 <- as.factor(data$BabyFeeding3)
levene_result <- leveneTest(mother_age ~ BabyFeeding3, data = data)
print(levene_result)


anova_result <- aov(mother_age ~ BabyFeeding3, data = data)
summary(anova_result)



###c part-post hoc
# Tukey HSD test
tukey_result <- TukeyHSD(anova_result)
print(tukey_result)


# Pairwise t-test with Bonferroni correction
bonferroni_result <- pairwise.t.test(data$mother_age, data$BabyFeeding3,p.adjust.method = "bonferroni", pool.sd = TRUE) 

# Print the results
print(bonferroni_result)
```




```{r question1}

library(ggplot2)


ggplot(data, aes(x = height0, y = weight0)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +  # Adding the trend line with linear model
  labs(title = "Scatter Plot of Weight vs Height",
       x = " Height (cm)",
       y = "Weight (kg)")



##pearson
test_result <- cor.test(data$weight0, data$height0, method = "pearson", use = "complete.obs")
print(test_result)



#spearman
spearman_test_result <- cor.test(data$weight0, data$height0, method = "spearman", use = "complete.obs")

# Print the test result
print(spearman_test_result)
```
##chi square
```{r pressure, echo=FALSE}

 
data$pacifier_dich <- factor(data$pacifier_dich, levels = c(0, 1), labels = c("no", "yes"))
data$newborn_gender <- factor(data$newborn_gender, levels = c(0, 1), labels = c("male", "female"))
# Create a contingency table
table_data <- table(data$pacifier_dich, data$newborn_gender)
table_data

# Calculate and print the percentage table
percent_table <- prop.table(table_data, margin = 1) * 100  # Row percentages
print(percent_table)
print(column_percentages)
column_percentages <- prop.table(table_data, margin = 2) * 100 #column percentages
print(column_percentages)

# Perform the chi-square test
chi_test <- chisq.test(table_data)

# Print the results of the chi-square test
print(chi_test)


expected_counts <- chi_test$expected
expected_counts
count_violations <- sum(expected_counts < 5)
total_counts <- length(expected_counts)
percentage_violations <- (count_violations / total_counts) * 100
percentage_violations


cat("Percentage of expected counts less than 5:", percentage_violations, "%\n")
if (percentage_violations > 20) {
  cat("Warning: More than 20% of expected counts are less than 5, which violates chi-square test assumptions.\n")
}

```


## OR and RR for 2*2
```{r question1}
install.packages("epitools")
library(epitools)

# Create a contingency table
contingency_table <- table(data$newborn_gender ,data$pacifier_dich)

# Compute Odds Ratio (OR) and Relative Risk (RR)
OR_result <- epitab(contingency_table, method = "oddsratio")
print(OR_result)

RR_result <- epitab(contingency_table, method = "riskratio")
print(RR_result)
```


##fisher
```{r pressure, echo=FALSE}
contingency_table <- table(data$newborn_gender, data$pacifier_dich)

# Perform Fisher's exact test
fisher_result <- fisher.test(contingency_table)

# Print the result
print(fisher_result)
```
